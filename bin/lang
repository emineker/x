#!/usr/bin/python
# -*- coding: utf-8 -*-

import urllib
import simplejson


def getSplits(text, splitLength=4500):
    '''
    Translate Api has a limit on length of text(4500 characters)
    that can be translated at once,
    '''
    return (text[index:index + splitLength] \
        for index in xrange(0, len(text), splitLength))


def translate(text, src='', to='en'):
    '''
    A Python Wrapper for Google AJAX Language API:
    * Uses Google Language Detection,
    in cases source language is not provided with the source text
    * Splits up text if it's longer then 4500 characters,
    as a limit put up by the API
    '''

    baseUrl = "http://ajax.googleapis.com/ajax/services/language/translate"

    params = ({'langpair': '%s|%s' % (src, to), 'v': '1.0'})

    retText = ''

    for text in getSplits(text):
        params['q'] = text
        resp = simplejson.load(urllib.urlopen('%s' % (baseUrl), \
                                data=urllib.urlencode(params))
                              )
        try:
            retText += resp['responseData']['translatedText']
        except:
            raise
    return retText

if __name__ == '__main__':

    print "> Çıkmak için 0'a basın"
    print "> Türkçe » İngilizce çeviri için 'en'"
    print "> İngilizce » Türkçe çeviri için 'tr' yazın"
    print "\n>  türkçe » ingilizce\n"

    where = {
             'tr': 'en',
             'en': 'tr'
            }

    to = {'tr': 'ingilizce » türkçe',
          'en': 'türkçe » ingilizce'
         }

    # default lang
    lang = 'en'

    text = ''

    while text != '0':
        text = raw_input('-> ')
        if text in where.keys():
            lang = text
            print '\n   %s\n' % where[text]
            continue

        print '-> %s\n' % translate(text, where[lang], to=lang)

    print '\n-> çıkılıyor...\n'
